<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styleLocate.css">
</head>

<body>
    <div id="head">
        <img src="../제목을 입력해주세요_-001 (2).png" alt="로고사진 넣기">
    </div>

    <div id="button-container">
    <button id="btn1">지도 생성 하기</button>
    <button id="btn2">나의 현재위치 알아오기!</button>
    <button id="btn3">마커 찍기(현재위치기준)</button>
    </div>
    <!-- 지도를 표시할 div 입니다 맵사이즈 수정가능 -->
    <!-- <div id="map" style="width:100%;height:550px;"></div> -->
    <div id="map">
    <section id="one" class="wrapper1 style2 fullscreen spotlights">
        <div class="inner">
        <div class="inner">
        </div>  


    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0dccf8fdccfbfda753146d246713cbbd"></script>
    <script>
        // 1. 지도를 만드는 함수를 제작
        const makeMap = (lat, lon) => {
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
                mapOption = {
                    center: new kakao.maps.LatLng(lat, lon), // 지도의 중심좌표
                    level: 6 // 지도의 확대 레벨
                };

            // 지도를 표시할 div와 지도 옵션으로 지도를 생성합니다
            var map = new kakao.maps.Map(mapContainer, mapOption);

            return map;
        }
         var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
               mapOption = {
                  center : new kakao.maps.LatLng(35.1595454, 126.8526012), // 광주광역시 지도의 중심좌표
                  level : 3 // 지도의 확대 레벨
               };
               var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
               
        const petShops = [
           {
              "name":"영희와 바둑이 애견미용샵",
              "address":"광주 광산구 하남대로54번안길 13 1층 상가",
              "Latitude":35.177298,
              "longitude":126.7993494,
              "phoneNumber":"062-954-6002",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20200105_199%2F1578229774372WFm6s_JPEG%2FO4eHYuGV6hMzqy8gXDdXRZwt.jpg"
           },
           {
              "name":"뽀삐 샵",
              "address":"광주 광산구 마항5길 3-7 1층",
              "Latitude":35.18495245,
              "longitude":126.7976492,
              "phoneNumber":"0507-1424-2802",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20230314_186%2F1678802232751EWhTD_JPEG%2FIMG_5443_%25281%2529.jpg"
           },
           {
              "name":"댕댕 샵",
              "address":"광주 광산구 하남대로261번길 11 301동 앞 상가 댕댕샵",
              "Latitude":35.18052622,
              "longitude":126.8200147,
              "phoneNumber":"0507-1305-1309",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20220613_28%2F16550460855011jdj1_JPEG%2F2A31AC58-410E-40FB-95CA-6675C3F9A7D4.jpeg"
           },
           {
              "name":"보보 펫",
              "address":"광주 광산구 하남대로54번길 65 1층",
              "Latitude":35.17711878,
              "longitude":126.7997703,
              "phoneNumber":"062-955-0082",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20210106_141%2F16099317300938ntDJ_JPEG%2FIdrvOMXtbvZLNai75cdHrrAY.jpg"
           },
           {
              "name":"The 사랑할개",
              "address":"광주 남구 서문대로627번길 19",
              "Latitude":35.11447346,
              "longitude":126.8950979,
              "phoneNumber":"062-653-4815",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20210830_16%2F1630319618753MeeJT_JPEG%2FK-_gQrg3e-6bb91mHqfyRUkL.jpeg.jpg"
           },
           {
              "name":"메리 펫 샵",
              "address":"광주 동구 경양로 234 상가119동 1층 809호",
              "Latitude":35.15755986,
              "longitude":126.915894,
              "phoneNumber":"010-5777-5168",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20231101_255%2F16988221645759hxuE_JPEG%2FIMG_4050.jpeg"
           },
           {
              "name":"헬로 퍼피 애견 미용샵",
              "address":"광주 동구 동계로 38",
              "Latitude":35.15557038,
              "longitude":126.9256843,
              "phoneNumber":"0507-1469-2238",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20210124_260%2F1611456495070wEOAy_JPEG%2FbHgWT8F0XSGx1L-uxj6YUKtQ.jpg"
           },
           {
              "name":"유폴 24시 애견셀프목욕 각화점",
              "address":"광주 북구 군왕로 295 116동 124호",
              "Latitude":35.18660427,
              "longitude":126.9375953,
              "phoneNumber":"0507-1357-9165",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20231117_98%2F1700223531279YSCkL_JPEG%2F33B91349-DDA2-459C-B957-D74D303E0C5C.jpeg"
           },
           {
              "name":"호수 펫",
              "address":"광주 북구 양산제로 105 111호 호수펫",
              "Latitude":35.20328456,
              "longitude":126.8697414,
              "phoneNumber":"0507-1303-1379",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20191103_6%2F15727887283949Ng3S_JPEG%2FcllftWxN53rv9hEqqAU3TikX.jpg"
           },
           {
              "name":"몽이뭉치 애견샵",
              "address":"광주 북구 양산제로 112 . 상가동 1층 107호",
              "Latitude":35.20307914,
              "longitude":126.8707483,
              "phoneNumber":"0507-1498-9334",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20230727_253%2F16904251611919mJPG_JPEG%2FKakaoTalk_20230727_112851175.jpg"
           },
           {
              "name":"발사탕 펫 살롱",
              "address":"광주 서구 군분로169번길 15-19 1층 발사탕 펫살롱",
              "Latitude":35.14561719,
              "longitude":126.8856275,
              "phoneNumber":"010-4718-1055",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20220709_33%2F1657340208722squ4s_JPEG%2F1657339783043.jpg"
           },
           {
              "name":"김채안 퍼피 살롱",
              "address":"광주 서구 금부로95번길 48-1",
              "Latitude":35.14404467,
              "longitude":126.8580881,
              "phoneNumber":"010-8432-0771",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20200417_37%2F1587098726424fBNnT_JPEG%2Ft34D-syRBmUN50qkjeKcH9gP.jpeg.jpg"
           },
           {
              "name":"마이 펫",
              "address":"광주 서구 풍금로11번길 12",
              "Latitude":35.12051496,
              "longitude":126.8646319,
              "phoneNumber":"062-682-2512",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20201102_219%2F1604310997185ha2CU_JPEG%2FGvhNxKsodKH0tmNAItJm115E.jpg"
           },
           {
              "name":"개털 도사",
              "address":"광주 서구 화개1로 59-2 상가128동 107호",
              "Latitude":35.1313264,
              "longitude":126.8536475,
              "phoneNumber":"010-5073-5628",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20231114_225%2F1699958132521Xf05O_JPEG%2FKakaoTalk_20231114_192337588.jpg"
           },
           {
              "name":"버블 펫",
              "address":"광주 서구 화개1로 63 1층 108호 (금호동) 버블펫",
              "Latitude":35.12963049,
              "longitude":126.855006,
              "phoneNumber":"0507-1393-7700",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20190303_175%2F1551600622427OmM7Q_JPEG%2F4zAV6rytH_CLkPN7wMA884CM.jpg"
           },
           {
              "name":"알로하 펫",
              "address":"광주 서구 화운로 116-1",
              "Latitude":35.14985137,
              "longitude":126.8788038,
              "phoneNumber":"0507-1407-6997",
              "petShopImg":"https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20230503_264%2F1683078781581hkN9m_JPEG%2FKakaoTalk_Photo_2023-05-03-10-52-10.jpeg"
           }
        ];

        // 2. btn1버튼에게 makeMap 함수 연결
        // 함수를 제작하고 요소를 연결할 때는 함수이름만 작성할 것
        let btn1 = document.getElementById("btn1")
        btn1.addEventListener("click", () => makeMap(35.1595454, 126.8526012))

        // 3. 현재위치를 알아오는 함수 제작 -> geolocation 라이브러리 -> JS기본 내장
        const getLocation = () => {
            navigator.geolocation.getCurrentPosition((position) => {
                console.log(position.coords.latitude);
                console.log(position.coords.longitude);
                let lat = position.coords.latitude
                let lon = position.coords.longitude
                // 함수안에서 다른 함수에게 값을 전달하는 경우에는 매개변수로 전달한다.
                // 전달했다면, 반드시 함수에도 매개변수가 필요하다.

                let map = makeMap(lat, lon);

                // 현재 위치 마커 표시
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(lat, lon),
                    title: "현재 위치"
                });

                var infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">현재 위치</div>`,
                    removable: true
                });

                infowindow.open(map, marker);

            })
        }
        // 4. btn2 버튼에 getLocation 연결
        let btn2 = document.getElementById("btn2")
        btn2.addEventListener('click', getLocation)

        // 전역 변수로 현재 열린 인포윈도우를 저장
        let currentInfoWindow = null;

        // 5. 지도 마커 찍기 함수
        const makeMarker = () => {
            navigator.geolocation.getCurrentPosition((position) => {
                console.log(position.coords.latitude);
                console.log(position.coords.longitude);
                let lat = position.coords.latitude
                let lon = position.coords.longitude

                var map = makeMap(lat, lon); // 현재 위치를 중심으로 지도 생성

                // 현재 위치 마커 표시
                var currentPositionMarker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(lat, lon),
                    title: "현재 위치"
                });

                var currentPositionInfoWindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">현재 위치</div>`,
                    removable: true
                });

                currentPositionInfoWindow.open(map, currentPositionMarker);

                // 마커 이미지의 이미지 주소입니다
                var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

                for (var i = 0; i < petShops.length; i++) {
                    let shop = petShops[i];

                    // 마커 이미지의 이미지 크기 입니다
                    var imageSize = new kakao.maps.Size(24, 35);

                    // 마커 이미지를 생성합니다    
                    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

                    // 마커를 생성합니다
                    var marker = new kakao.maps.Marker({
                        map: map, // 마커를 표시할 지도
                        position: new kakao.maps.LatLng(shop.Latitude, shop.longitude), // 마커를 표시할 위치
                        title: shop.name, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                        image: markerImage // 마커 이미지 
                    });

                    // 마커에 클릭이벤트를 등록합니다
                    kakao.maps.event.addListener(marker, 'click', (function(marker, shop) {
                        return function() {
                            // 현재 열려 있는 인포윈도우가 있다면 닫기
                            if (currentInfoWindow) {
                                currentInfoWindow.close();
                            }

                            // 마커 위에 인포윈도우를 표시합니다
                            var content = `<div class='info'> 
                                <div class="title">${shop.name}</div>
                                <div class="body">
                                    <div class="img">
                                        <img src="${shop.petShopImg}" width="200" height="150">
                                    </div><br>
                                    <div class="desc">
                                        <div class="ellipsis">${shop.address}</div>
                                        <div>${shop.phoneNumber}</div>
                                        <div><a href="#" onclick="openImagePopup('${shop.petShopImg}')" target="_blank" class="link">등록이미지</a></div>
                                    </div>
                                </div>
                            </div>`;

                            var infowindow = new kakao.maps.InfoWindow({
                                content: content,
                                removable: true
                            });

                            infowindow.open(map, marker);

                            // 현재 열린 인포윈도우를 저장
                            currentInfoWindow = infowindow;

                            // 지도 중심을 클릭된 마커로 이동
                            // map.setCenter(new kakao.maps.LatLng(shop.Latitude, shop.longitude));
                        };
                    })(marker, shop));
                }
            })
        }

        // 새 창에 이미지를 표시하는 함수
        function openImagePopup(imageUrl) {
            var imgWindow = window.open("", "Image", "width=600,height=400");
            imgWindow.document.write(`<img src="${imageUrl}" style="width:100%;height:100%;">`);
        }

        // 6. btn3버튼에 makeMarker함수 연결
        let btn3 = document.getElementById('btn3')
        btn3.addEventListener('click', makeMarker)

    </script>
</body>

</html>
